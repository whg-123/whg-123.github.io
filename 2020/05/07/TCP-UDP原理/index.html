<!DOCTYPE html>
<html>
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  
  <title>TCP/UDP原理 - Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  
  <meta name="keywords" content=生活,博客,前端,游戏>
  
  
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.02">
  
  
    <link rel="alternate" href="/atom.xml " title="Hexo" type="application/atom+xml">
  

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>
  <body>
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">Hexo</a>
    <div class="subtitle"></div>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link">Archives</a>
        </li>
      
        <li class="menu-item">
          <a href="/about" class="menu-item-link">About</a>
        </li>
      
    </ul>
  </nav>
</header>
<article class="post">
  <div class="post-title">
    <h1 class="article-title">TCP/UDP原理</h1>
  </div>
   <div class="post-meta">
    <span class="post-time">2020-05-07</span>
  </div>
  <div class="post-content">
    <h2 id="TCP-UDP基本原理"><a href="#TCP-UDP基本原理" class="headerlink" title="TCP/UDP基本原理"></a>TCP/UDP基本原理</h2><h4 id="1、端口"><a href="#1、端口" class="headerlink" title="1、端口"></a>1、端口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">定义：</span><br><span class="line">	每个应用程序进出网络都需要经过一个唯一端口，通过端口号来识别数据交由哪个应用程序处理</span><br><span class="line">	</span><br><span class="line">服务端：固定端口号</span><br><span class="line"></span><br><span class="line">客户端：1024以上为随机端口号，用于本机建立端口使用的端口号</span><br><span class="line"></span><br><span class="line">知名端口号：</span><br><span class="line">	TCP http 80：超文本传输协议</span><br><span class="line">	TCP ftp 20 21：文件传输协议</span><br><span class="line">	TCP telnet 23：远程登录协议</span><br><span class="line">	TCP smtp 25：简单邮件传输协议</span><br><span class="line">	UDP dns 53：域名解析协议</span><br><span class="line">	TCP HTTPS 443：HTTP over SSL</span><br></pre></td></tr></table></figure>

<h4 id="2、TCP封装"><a href="#2、TCP封装" class="headerlink" title="2、TCP封装"></a>2、TCP封装</h4><p><img src="/images/TCP-UDP%E5%8E%9F%E7%90%86/image-20200507162502842.png" alt="image-20200507162502842"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">	Source Port：源端口</span><br><span class="line">	Destination Port：目的端口</span><br><span class="line">	Sequence Number：序列号，标识本机发送的数据报文的编号</span><br><span class="line">	ACknowledgement Number：确认号，标识请求对方下次发送的数据报文的编号</span><br><span class="line">	Date offset：数据偏移，标识数据分段在完整数据中的位置</span><br><span class="line">	Reserved：保留位，目前没有作用，为以后TCP添加功能使用的</span><br><span class="line">六个标志位：</span><br><span class="line">	URG：</span><br><span class="line">	ACK：确认位开关</span><br><span class="line">	RSH：</span><br><span class="line">	RST：</span><br><span class="line">	SYN：握手开关（1代表开启，0代表关闭）</span><br><span class="line">	FIN：结束开关（1代表开启，0代表关闭）</span><br></pre></td></tr></table></figure>

<h4 id="3、TCP可靠性机制"><a href="#3、TCP可靠性机制" class="headerlink" title="3、TCP可靠性机制"></a>3、TCP可靠性机制</h4><p><strong>3.1 确认机制</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Seq&#x3D;上一次的ack</span><br><span class="line">ACk&#x3D;上一次的seq+length</span><br><span class="line">如果没有接受到，或接收到的是不完整数据，会再次发送Ack请求对方重发</span><br><span class="line">通过这个机制发送数据对方一定是收得到的</span><br></pre></td></tr></table></figure>

<p><img src="/images/TCP-UDP%E5%8E%9F%E7%90%86/image-20200507164343740.png" alt="image-20200507164343740"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主机A建立连接第一次发送数据时，会随机产生一个序列号（是seq，这里的序列号随机为1），数据长度（len）为1024</span><br><span class="line">那么下一次数据的序列号（seq）为上一次的seq+len，以此类推，直到主机B收到</span><br><span class="line">主机B收到之后，会进行差错校验，差错校验通过后数据没有问题会向主机A回复一个包，这个包里有一个确认号（Ack），这里的Ack是表示下一次主机A向主机B发送数据的seq，以此类推</span><br></pre></td></tr></table></figure>

<h5 id="如果一次传输多个数据包，最后一个包有问题时"><a href="#如果一次传输多个数据包，最后一个包有问题时" class="headerlink" title="如果一次传输多个数据包，最后一个包有问题时"></a>如果一次传输多个数据包，最后一个包有问题时</h5><p><img src="/images/TCP-UDP%E5%8E%9F%E7%90%86/image-20200507165716097.png" alt="image-20200507165716097"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">那么主机B将会回复主机A将下一次传输从序列号（Seq）为3073开始发送数据</span><br></pre></td></tr></table></figure>

<p><strong>如果一次性传输多个包，中间的包有问题时</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">一种与上面的情况一样，从错误的包的序列号开始发多个包</span><br><span class="line">	这种情况第二次发包的时候会出现重复的包，后来发的包如果与之前发包的序列号一致会覆盖原有的包</span><br><span class="line"></span><br><span class="line">一种是单独将那个包发一次，然后目的主机做确认，再重新一次性发多个包（H3C默认使用此方式），这种方式会消耗更多资源</span><br></pre></td></tr></table></figure>

<p><img src="/images/TCP-UDP%E5%8E%9F%E7%90%86/image-20200507170146939.png" alt="image-20200507170146939"></p>
<h5 id="3-2-三次握手（TCP连接的建立）"><a href="#3-2-三次握手（TCP连接的建立）" class="headerlink" title="3.2 三次握手（TCP连接的建立）"></a>3.2 三次握手（TCP连接的建立）</h5><p><img src="/images/TCP-UDP%E5%8E%9F%E7%90%86/image-20200507172610230.png" alt="image-20200507172610230"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主机A向主机B发送SYN&#x3D;1（代表主机A向主机B请求建立连接的握手报文）</span><br><span class="line">主机B如果同意这个请求时，主机B向主机A发送ACK&#x3D;1（告诉主机A同意它的请求）和SYN&#x3D;1（代表这是主机B向主机A请求建立连接的握手报文）</span><br><span class="line">主机A如果同意这个请求时，主机A向主机B发送ACK&#x3D;1（告诉主机B同意它的请求）</span><br></pre></td></tr></table></figure>

<h5 id="3-3-四次挥手（TCP建立的拆除）"><a href="#3-3-四次挥手（TCP建立的拆除）" class="headerlink" title="3.3 四次挥手（TCP建立的拆除）"></a>3.3 四次挥手（TCP建立的拆除）</h5><p><img src="/images/TCP-UDP%E5%8E%9F%E7%90%86/image-20200507173410523.png" alt="image-20200507173410523"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">主机A向主机B发送FIN&#x3D;1（代表主机A向主机B请求拆除连接的握手报文）</span><br><span class="line">如果主机B同意这个请求时，主机B向主机A发送ACK&#x3D;1（告诉主机A同意它的请求）</span><br><span class="line">这时主机B向主机A发送FIN&#x3D;1（代表主机B向主机A请求拆除连接的握手报文）</span><br><span class="line">如果主机A同意这个请求时，主机A向主机B发送ACK&#x3D;1（告诉主机B同意它的请求）</span><br><span class="line"></span><br><span class="line">挥手比握手多一次，是因为假如说主机A向主机B数据发送完毕请求拆除时，这是要看主机B是否有数据向主机A发送，如果没有那么主机B也会向主机A请求拆除，如果有，那么它将不会拆除直到主机B向主机A传输完数据之后，再拆除</span><br></pre></td></tr></table></figure>


  </div>
  <div class="post-footer">
    

    <a href="#top" class="top">Back to Top</a>
  </div>
</article>
<footer>
  &copy; 2020
  <span class="author">
    John Doe
  </span>
</footer>
    </div>
  </body>
</html>